# Memory Module

## ê°œìš”
ì´ ëª¨ë“ˆì€ Java ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ë©”ëª¨ë¦¬ ê´€ë¦¬ì™€ GC(Garbage Collection) ë™ì‘ì„ í…ŒìŠ¤íŠ¸í•˜ê³  ë¶„ì„í•˜ê¸° ìœ„í•œ ë„êµ¬ì…ë‹ˆë‹¤.
í˜„ì¬ëŠ” OOM(Out Of Memory) í…ŒìŠ¤íŠ¸ ê¸°ëŠ¥ì„ ì œê³µí•©ë‹ˆë‹¤.

## ê¸°ëŠ¥

### ğŸ§ª OOM í…ŒìŠ¤íŠ¸ API

#### 1. ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ í…ŒìŠ¤íŠ¸ (Memory Leak)
- **Endpoint**: `GET /memory/leak`
- **ì„¤ëª…**: 500ë§Œê°œì˜ String ê°ì²´ë¥¼ ìƒì„±í•˜ì—¬ ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ì„ ì¦ê°€ì‹œí‚µë‹ˆë‹¤
- **íŠ¹ì§•**: ìƒì„±ëœ ê°ì²´ë“¤ì´ ì¸ìŠ¤í„´ìŠ¤ ë³€ìˆ˜ì— ì €ì¥ë˜ì–´ GCë˜ì§€ ì•ŠìŠµë‹ˆë‹¤

#### 2. ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ í…ŒìŠ¤íŠ¸ (ì ˆë°˜ í¬ê¸°)
- **Endpoint**: `GET /memory/leak/half`
- **ì„¤ëª…**: 500ë§Œê°œì˜ String ê°ì²´ë¥¼ ë¡œì»¬ ë³€ìˆ˜ë¡œ ìƒì„±í•©ë‹ˆë‹¤
- **íŠ¹ì§•**: ë©”ì†Œë“œ ì¢…ë£Œ í›„ GC ëŒ€ìƒì´ ë©ë‹ˆë‹¤

#### 3. ë©”ëª¨ë¦¬ ì •ë¦¬
- **Endpoint**: `GET /memory/clear`
- **ì„¤ëª…**: ì €ì¥ëœ ë©”ëª¨ë¦¬ ê°ì²´ë“¤ì„ ì •ë¦¬í•©ë‹ˆë‹¤
- **ë™ì‘**: `memory.clear()`ë¥¼ í˜¸ì¶œí•˜ì—¬ ì°¸ì¡°ë¥¼ í•´ì œí•©ë‹ˆë‹¤

#### 4. í—¬ìŠ¤ ì²´í¬
- **Endpoint**: `GET /memory/health-check`
- **ì„¤ëª…**: ì• í”Œë¦¬ì¼€ì´ì…˜ ìƒíƒœë¥¼ í™•ì¸í•©ë‹ˆë‹¤

## ğŸš€ ì‹¤í–‰ ë°©ë²•

### í•„ìˆ˜ VMOption ì„¤ì •

OOM í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•´ì„œëŠ” **ë°˜ë“œì‹œ** ë‹¤ìŒ VMOptionì„ ì„¤ì •í•´ì•¼ í•©ë‹ˆë‹¤:

```bash
-Xlog:gc*:file=gc.log:time,uptime,level,tags -Xmn100m -Xmx500m
```

#### VMOption ì„¤ëª…
- `-Xlog:gc*:file=gc.log:time,uptime,level,tags`: GC ë¡œê·¸ë¥¼ gc.log íŒŒì¼ì— ìƒì„¸íˆ ê¸°ë¡
- `-Xmn100m`: Young Generation í¬ê¸°ë¥¼ 100MBë¡œ ì„¤ì •
- `-Xmx500m`: ìµœëŒ€ í™ ë©”ëª¨ë¦¬ë¥¼ 500MBë¡œ ì œí•œ

### IDEì—ì„œ ì‹¤í–‰
1. **IntelliJ IDEA**:
   - Run Configuration â†’ VM optionsì— ìœ„ ì˜µì…˜ ì¶”ê°€
   - ë˜ëŠ” `MemoryApplication` í´ë˜ìŠ¤ ìƒë‹¨ ì£¼ì„ ì°¸ì¡°

2. **Eclipse**:
   - Run Configurations â†’ Arguments â†’ VM argumentsì— ì¶”ê°€

### ëª…ë ¹ì¤„ì—ì„œ ì‹¤í–‰
```bash
java -Xlog:gc*:file=gc.log:time,uptime,level,tags -Xmn100m -Xmx500m -jar memory-module.jar
```

## ğŸ“Š í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤

### 1. ê¸°ë³¸ ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ í…ŒìŠ¤íŠ¸
```bash
# 1. ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ ë°œìƒ
curl http://localhost:8080/memory/leak

# 2. GC ë¡œê·¸ í™•ì¸
tail -f gc.log

# 3. ë©”ëª¨ë¦¬ ì •ë¦¬
curl http://localhost:8080/memory/clear
```

### 2. GC ë™ì‘ ë¶„ì„
```bash
# ì ˆë°˜ í¬ê¸° í…ŒìŠ¤íŠ¸ (ë¡œì»¬ ë³€ìˆ˜)
curl http://localhost:8080/memory/leak/half

# GC ë¡œê·¸ì—ì„œ Young GC ë°œìƒ í™•ì¸
grep "Pause Young" gc.log
```

## ğŸ“ˆ GC ë¡œê·¸ ë¶„ì„

ìƒì„±ë˜ëŠ” `gc.log` íŒŒì¼ì—ì„œ ë‹¤ìŒ ì •ë³´ë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

- **Young GC**: `Pause Young (Normal)`
- **Mixed GC**: `Pause Young (Mixed)`
- **Full GC**: `Pause Full`
- **Concurrent Mark Cycle**: ë°±ê·¸ë¼ìš´ë“œ ë§ˆí‚¹ ì‘ì—…
- **ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰**: `Before->After(Total)`

### ì£¼ìš” GC íŒ¨í„´
```
[ì‹œê°„][ì—…íƒ€ì„][ë ˆë²¨][íƒœê·¸] GC(ë²ˆí˜¸) íƒ€ì… ë©”ëª¨ë¦¬ë³€í™” ì†Œìš”ì‹œê°„
```

ì˜ˆì‹œ:
```
[2025-08-11T16:18:27.168+0900][221.620s][info][gc] GC(55) Pause Remark 471M->65M(224M) 7.500ms
```

## ğŸ“Š ì‹¤ì‹œê°„ GC ëª¨ë‹ˆí„°ë§ (VisualVM)

### VisualVM ì‚¬ìš© ê¶Œì¥

**VisualVM**ì€ Java ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ê³¼ GC ë™ì‘ì„ ì‹¤ì‹œê°„ìœ¼ë¡œ ì‹œê°ì ìœ¼ë¡œ ëª¨ë‹ˆí„°ë§í•  ìˆ˜ ìˆëŠ” ê°•ë ¥í•œ ë„êµ¬ì…ë‹ˆë‹¤.



## ğŸ”§ ê°œë°œ í™˜ê²½

- **Java**: 17
- **Spring Boot**: 3.x
- **GC**: G1GC (ê¸°ë³¸ê°’)
- **ì•„í‚¤í…ì²˜**: Spring WebMVC

## âš ï¸ ì£¼ì˜ì‚¬í•­

1. **VMOption í•„ìˆ˜**: ìœ„ì— ëª…ì‹œëœ VMOption ì—†ì´ëŠ” ì •í™•í•œ í…ŒìŠ¤íŠ¸ê°€ ë¶ˆê°€ëŠ¥í•©ë‹ˆë‹¤
2. **ë©”ëª¨ë¦¬ ì œí•œ**: `-Xmx500m` ì„¤ì •ìœ¼ë¡œ ì¸í•´ OOMì´ ë°œìƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤
3. **ë¡œê·¸ íŒŒì¼**: `gc.log` íŒŒì¼ì´ í”„ë¡œì íŠ¸ ë£¨íŠ¸ì— ìƒì„±ë©ë‹ˆë‹¤
4. **ìš´ì˜ í™˜ê²½ ì£¼ì˜**: ì´ ëª¨ë“ˆì€ í…ŒìŠ¤íŠ¸ ëª©ì ìœ¼ë¡œë§Œ ì‚¬ìš©í•˜ì„¸ìš”

## ğŸ“ ë¡œê·¸ ì˜ˆì‹œ

### Young GC ë°œìƒ
```
[2025-08-11T16:18:27.116+0900][221.569s][info][gc] GC(54) Pause Young (Concurrent Start) (G1 Preventive Collection) 484M->470M(504M) 5.220ms
```

### Concurrent Mark Cycle
```
[2025-08-11T16:18:27.168+0900][221.620s][info][gc] GC(55) Pause Remark 471M->65M(224M) 7.500ms
```

### Full GC ë°œìƒ
```
[2025-08-11T16:25:36.156+0900][650.619s][info][gc] GC(76) Pause Full (G1 Compaction Pause) 502M->173M(504M) 45.775ms
```
